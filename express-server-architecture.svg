<?xml version="1.0" encoding="UTF-8"?>
<svg width="1200" height="900" xmlns="http://www.w3.org/2000/svg" style="background: #f8f9fa;">
  <defs>
    <!-- Gradients for visual appeal -->
    <linearGradient id="serverGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#2c5aa0;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#1e3a5f;stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="middlewareGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#28a745;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#1e7e34;stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="endpointGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#ffc107;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#e0a800;stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="databaseGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#dc3545;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#b02a37;stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="agentGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#6f42c1;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#5a32a3;stop-opacity:1" />
    </linearGradient>
    
    <!-- Drop shadow filter -->
    <filter id="dropshadow" x="0" y="0" width="120%" height="120%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.3"/>
    </filter>
  </defs>
  
  <!-- Title -->
  <text x="600" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#2c3e50">
    Express.js AI Agent Server Architecture
  </text>
  
  <!-- SSL/HTTPS Layer -->
  <rect x="50" y="60" width="1100" height="40" fill="#17a2b8" stroke="#138496" stroke-width="2" rx="5" filter="url(#dropshadow)"/>
  <text x="600" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">
    ðŸ”’ HTTPS/SSL Layer (server.key, server.cert)
  </text>
  
  <!-- Express Server Core -->
  <rect x="100" y="120" width="1000" height="60" fill="url(#serverGrad)" stroke="#1e3a5f" stroke-width="2" rx="8" filter="url(#dropshadow)"/>
  <text x="600" y="145" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white">
    Express.js Server Core
  </text>
  <text x="600" y="165" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="white">
    Port: ${PORT} | Host: ${HOST} | Entry: index.ts
  </text>
  
  <!-- Middleware Stack -->
  <rect x="150" y="200" width="900" height="140" fill="url(#middlewareGrad)" stroke="#1e7e34" stroke-width="2" rx="8" filter="url(#dropshadow)"/>
  <text x="600" y="220" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">
    Middleware Stack
  </text>
  
  <!-- Individual Middleware Components -->
  <rect x="170" y="235" width="120" height="25" fill="#20c997" stroke="#17a2b8" stroke-width="1" rx="3"/>
  <text x="230" y="252" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">Helmet</text>
  
  <rect x="300" y="235" width="120" height="25" fill="#20c997" stroke="#17a2b8" stroke-width="1" rx="3"/>
  <text x="360" y="252" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">CORS</text>
  
  <rect x="430" y="235" width="120" height="25" fill="#20c997" stroke="#17a2b8" stroke-width="1" rx="3"/>
  <text x="490" y="252" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">Rate Limit</text>
  
  <rect x="560" y="235" width="120" height="25" fill="#20c997" stroke="#17a2b8" stroke-width="1" rx="3"/>
  <text x="620" y="252" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">Compression</text>
  
  <rect x="690" y="235" width="120" height="25" fill="#20c997" stroke="#17a2b8" stroke-width="1" rx="3"/>
  <text x="750" y="252" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">Body Parsers</text>
  
  <rect x="820" y="235" width="120" height="25" fill="#20c997" stroke="#17a2b8" stroke-width="1" rx="3"/>
  <text x="880" y="252" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">Session Auth</text>
  
  <!-- Parser Details -->
  <text x="600" y="280" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">
    Body Parsers: JSON, Raw, Text, URLEncoded (1MB limit)
  </text>
  
  <text x="600" y="295" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">
    Rate Limit: 60 req/min | Auth: Session-based with DB validation
  </text>
  
  <text x="600" y="310" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">
    Security: Helmet + CORS | Compression: gzip/deflate
  </text>
  
  <!-- API Endpoints -->
  <rect x="200" y="360" width="800" height="100" fill="url(#endpointGrad)" stroke="#e0a800" stroke-width="2" rx="8" filter="url(#dropshadow)"/>
  <text x="600" y="380" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#2c3e50">
    API Endpoints
  </text>
  
  <!-- Individual Endpoints -->
  <rect x="220" y="395" width="150" height="30" fill="#fd7e14" stroke="#dc3545" stroke-width="1" rx="5"/>
  <text x="295" y="408" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">POST /login</text>
  <text x="295" y="420" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">Basic Auth</text>
  
  <rect x="390" y="395" width="180" height="30" fill="#fd7e14" stroke="#dc3545" stroke-width="1" rx="5"/>
  <text x="480" y="408" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">POST /chat/:agent</text>
  <text x="480" y="420" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">AI Conversation</text>
  
  <rect x="590" y="395" width="180" height="30" fill="#fd7e14" stroke="#dc3545" stroke-width="1" rx="5"/>
  <text x="680" y="408" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">POST /validate/:agent</text>
  <text x="680" y="420" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">Data Validation</text>
  
  <rect x="790" y="395" width="150" height="30" fill="#fd7e14" stroke="#dc3545" stroke-width="1" rx="5"/>
  <text x="865" y="408" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">Error Handler</text>
  <text x="865" y="420" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">500 Response</text>
  
  <!-- AI Agent System -->
  <rect x="50" y="480" width="380" height="140" fill="url(#agentGrad)" stroke="#5a32a3" stroke-width="2" rx="8" filter="url(#dropshadow)"/>
  <text x="240" y="500" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">
    AI Agent System
  </text>
  
  <!-- Agent Components -->
  <rect x="70" y="515" width="100" height="25" fill="#8e44ad" stroke="#6c3483" stroke-width="1" rx="3"/>
  <text x="120" y="532" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">GeneralAgent</text>
  
  <rect x="190" y="515" width="100" height="25" fill="#8e44ad" stroke="#6c3483" stroke-width="1" rx="3"/>
  <text x="240" y="532" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">LLM Providers</text>
  
  <rect x="310" y="515" width="100" height="25" fill="#8e44ad" stroke="#6c3483" stroke-width="1" rx="3"/>
  <text x="360" y="532" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">MCP Manager</text>
  
  <!-- LLM Provider Details -->
  <text x="240" y="555" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">
    LLM Providers: GitHub Copilot, Ollama, OpenAI
  </text>
  
  <text x="240" y="570" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">
    MCP Servers: filesystem, memory, context7
  </text>
  
  <text x="240" y="585" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">
    Features: Token limiting, Session management
  </text>
  
  <text x="240" y="600" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">
    Agent Types: general, weather (extensible)
  </text>
  
  <!-- Database Layer -->
  <rect x="450" y="480" width="320" height="140" fill="url(#databaseGrad)" stroke="#b02a37" stroke-width="2" rx="8" filter="url(#dropshadow)"/>
  <text x="610" y="500" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">
    Database Layer
  </text>
  
  <!-- Database Components -->
  <rect x="470" y="515" width="100" height="25" fill="#e74c3c" stroke="#c0392b" stroke-width="1" rx="3"/>
  <text x="520" y="532" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">PostgreSQL</text>
  
  <rect x="590" y="515" width="100" height="25" fill="#e74c3c" stroke="#c0392b" stroke-width="1" rx="3"/>
  <text x="640" y="532" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">Repository</text>
  
  <rect x="710" y="515" width="50" height="25" fill="#e74c3c" stroke="#c0392b" stroke-width="1" rx="3"/>
  <text x="735" y="532" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">ORM</text>
  
  <!-- Database Details -->
  <text x="610" y="555" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">
    Entities: Session, User
  </text>
  
  <text x="610" y="570" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">
    Features: Connection pooling, Decorators
  </text>
  
  <text x="610" y="585" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">
    Authentication: SHA256 password hashing
  </text>
  
  <text x="610" y="600" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">
    Session: Random alphanumeric tokens
  </text>
  
  <!-- External Services -->
  <rect x="790" y="480" width="320" height="140" fill="#17a2b8" stroke="#138496" stroke-width="2" rx="8" filter="url(#dropshadow)"/>
  <text x="950" y="500" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">
    External Services
  </text>
  
  <!-- External Service Components -->
  <rect x="810" y="515" width="110" height="25" fill="#20c997" stroke="#17a2b8" stroke-width="1" rx="3"/>
  <text x="865" y="532" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">GitHub Copilot</text>
  
  <rect x="940" y="515" width="80" height="25" fill="#20c997" stroke="#17a2b8" stroke-width="1" rx="3"/>
  <text x="980" y="532" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">Ollama</text>
  
  <rect x="1040" y="515" width="60" height="25" fill="#20c997" stroke="#17a2b8" stroke-width="1" rx="3"/>
  <text x="1070" y="532" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">OpenAI</text>
  
  <!-- External Services Details -->
  <text x="950" y="555" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">
    API Integration: OAuth, Token-based
  </text>
  
  <text x="950" y="570" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">
    Models: GPT-4o, GPT-4o-mini, Local models
  </text>
  
  <text x="950" y="585" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">
    Features: Token limiting, Health checks
  </text>
  
  <text x="950" y="600" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white">
    Fallback: Automatic model switching
  </text>
  
  <!-- Process Management -->
  <rect x="150" y="640" width="900" height="80" fill="#343a40" stroke="#212529" stroke-width="2" rx="8" filter="url(#dropshadow)"/>
  <text x="600" y="660" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">
    Process Management &amp; Lifecycle
  </text>
  
  <!-- Process Management Components -->
  <rect x="170" y="675" width="120" height="25" fill="#6c757d" stroke="#495057" stroke-width="1" rx="3"/>
  <text x="230" y="692" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">Graceful Shutdown</text>
  
  <rect x="310" y="675" width="120" height="25" fill="#6c757d" stroke="#495057" stroke-width="1" rx="3"/>
  <text x="370" y="692" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">Signal Handling</text>
  
  <rect x="450" y="675" width="120" height="25" fill="#6c757d" stroke="#495057" stroke-width="1" rx="3"/>
  <text x="510" y="692" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">Connection Mgmt</text>
  
  <rect x="590" y="675" width="120" height="25" fill="#6c757d" stroke="#495057" stroke-width="1" rx="3"/>
  <text x="650" y="692" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">Agent Cleanup</text>
  
  <rect x="730" y="675" width="120" height="25" fill="#6c757d" stroke="#495057" stroke-width="1" rx="3"/>
  <text x="790" y="692" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">DB Pool Close</text>
  
  <rect x="870" y="675" width="120" height="25" fill="#6c757d" stroke="#495057" stroke-width="1" rx="3"/>
  <text x="930" y="692" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">Timeout Control</text>
  
  <!-- Data Flow Arrows -->
  <!-- Request flow -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#2c3e50" />
    </marker>
  </defs>
  
  <!-- Arrows showing data flow -->
  <line x1="600" y1="100" x2="600" y2="120" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="600" y1="180" x2="600" y2="200" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="600" y1="340" x2="600" y2="360" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Side arrows to components -->
  <line x1="450" y1="410" x2="240" y2="480" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="550" y1="410" x2="610" y2="480" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="650" y1="410" x2="950" y2="480" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Environment Configuration -->
  <rect x="50" y="740" width="300" height="100" fill="#f8f9fa" stroke="#dee2e6" stroke-width="2" rx="8" filter="url(#dropshadow)"/>
  <text x="200" y="760" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#2c3e50">
    Environment Configuration
  </text>
  
  <text x="60" y="780" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
    â€¢ PORT, HOST, SERVER_TERMINATE_TIMEOUT
  </text>
  <text x="60" y="795" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
    â€¢ DB_USER, DB_HOST, DB_PASSWORD, DB_PORT
  </text>
  <text x="60" y="810" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
    â€¢ LLM_PROVIDER, LLM_MODEL
  </text>
  <text x="60" y="825" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
    â€¢ GITHUB_TOKEN, MAX_LLM_ITERATIONS
  </text>
  
  <!-- Security Features -->
  <rect x="370" y="740" width="280" height="100" fill="#f8f9fa" stroke="#dee2e6" stroke-width="2" rx="8" filter="url(#dropshadow)"/>
  <text x="510" y="760" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#2c3e50">
    Security Features
  </text>
  
  <text x="380" y="780" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
    â€¢ HTTPS/SSL with certificates
  </text>
  <text x="380" y="795" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
    â€¢ Session-based authentication
  </text>
  <text x="380" y="810" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
    â€¢ Rate limiting (60 req/min)
  </text>
  <text x="380" y="825" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
    â€¢ Input validation with Zod schemas
  </text>
  
  <!-- Performance Features -->
  <rect x="670" y="740" width="280" height="100" fill="#f8f9fa" stroke="#dee2e6" stroke-width="2" rx="8" filter="url(#dropshadow)"/>
  <text x="810" y="760" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#2c3e50">
    Performance Features
  </text>
  
  <text x="680" y="780" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
    â€¢ Response compression (gzip/deflate)
  </text>
  <text x="680" y="795" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
    â€¢ Connection pooling &amp; management
  </text>
  <text x="680" y="810" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
    â€¢ Token limit handling &amp; truncation
  </text>
  <text x="680" y="825" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
    â€¢ Graceful shutdown with timeout
  </text>
  
  <!-- Monitoring -->
  <rect x="970" y="740" width="180" height="100" fill="#f8f9fa" stroke="#dee2e6" stroke-width="2" rx="8" filter="url(#dropshadow)"/>
  <text x="1060" y="760" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#2c3e50">
    Monitoring
  </text>
  
  <text x="980" y="780" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
    â€¢ Structured logging
  </text>
  <text x="980" y="795" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
    â€¢ Health checks
  </text>
  <text x="980" y="810" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
    â€¢ Error handling
  </text>
  <text x="980" y="825" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">
    â€¢ Signal monitoring
  </text>
  
  <!-- Footer -->
  <text x="600" y="870" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#6c757d">
    Generated: Express.js AI Agent Server Architecture (TypeScript-based, Production-ready)
  </text>
</svg>